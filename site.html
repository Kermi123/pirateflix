<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PirateFlix - Фильм</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background: linear-gradient(90deg, #ff0066, #00ccff);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
        }
        h1 {
            margin: 0;
            font-size: 3em;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #fff;
        }
        .auth-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .auth-buttons button, .auth-buttons a, .auth-buttons span {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #ff3366;
            color: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.2s;
            text-decoration: none;
        }
        .auth-buttons span {
            background: none;
            cursor: default;
        }
        .auth-buttons a.username {
            background-color: #00ccff;
            cursor: pointer;
        }
        .auth-buttons button:hover, .auth-buttons a.username:hover {
            background-color: #cc0052;
            transform: scale(1.05);
        }
        .search-bar {
            margin: 20px auto;
            max-width: 600px;
            display: flex;
            justify-content: center;
        }
        .search-bar input {
            padding: 12px;
            width: 70%;
            border: none;
            border-radius: 5px 0 0 5px;
            font-size: 1em;
            background-color: #2c2c2c;
            color: #fff;
            outline: none;
            transition: background-color 0.3s;
        }
        .search-bar input:focus {
            background-color: #3c3c3c;
        }
        .search-bar button {
            padding: 12px 20px;
            border: none;
            border-radius: 0 5px 5px 0;
            background-color: #ff3366;
            color: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.2s;
        }
        .search-bar button:hover {
            background-color: #cc0052;
            transform: scale(1.05);
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .movie-card {
            background-color: #2a2a2a;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }
        .movie-poster img {
            max-width: 250px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .movie-info {
            flex: 1;
            min-width: 300px;
        }
        .movie-info h2 {
            font-size: 2.2em;
            margin: 0 0 15px;
            color: #00ccff;
            text-shadow: 0 0 5px #00ccff;
        }
        .movie-info p {
            line-height: 1.8;
            margin: 10px 0;
            color: #ccc;
        }
        .ratings {
            margin: 20px 0;
        }
        .ratings h3 {
            margin: 0 0 15px;
            color: #ff3366;
            text-shadow: 0 0 5px #ff3366;
        }
        .trailer-section {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        .trailer-section h3 {
            font-size: 1.5em;
            color: #00ccff;
            text-shadow: 0 0 5px #00ccff;
            margin-bottom: 15px;
        }
        .trailer-section iframe {
            width: 100%;
            max-width: 800px;
            height: 450px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 102, 153, 0.3);
            animation: pink-glow 2s ease-in-out infinite alternate;
        }
        @keyframes pink-glow {
            from {
                box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 102, 153, 0.3);
            }
            to {
                box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4), 0 0 30px rgba(255, 102, 153, 0.5);
            }
        }
        .download-button {
            display: block;
            margin: 20px auto;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #ff3366, #cc0052);
            color: #fff;
            font-size: 1.2em;
            text-decoration: none;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
            text-align: center;
        }
        .download-button:hover {
            background: linear-gradient(45deg, #cc0052, #ff3366);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.7);
        }
        .user-interaction {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }
        .rating-section {
            margin: 10px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }
        .star-rating-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            width: 100%;
        }
        .star-rating {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        .star-rating .star {
            font-size: 2em;
            cursor: pointer;
            color: #888;
            transition: color 0.3s ease, transform 0.3s ease;
            width: 25px;
            text-align: center;
        }
        .star-rating .star.filled {
            color: #ffd700;
            transform: scale(1.1);
            text-shadow: 0 0 10px #ffd700, 0 0 20px #ffcc00;
        }
        .star-rating .star:hover,
        .star-rating .star.hovered {
            color: #ffd700;
            transform: scale(1.1);
        }
        .average-rating {
            font-size: 1.3em;
            color: #00ccff;
            text-shadow: 0 0 5px #00ccff;
        }
        .vote-count {
            font-size: 1em;
            color: #ccc;
        }
        .vote-message {
            margin-top: 5px;
            padding: 8px;
            background: rgba(60, 60, 60, 0.6);
            border-radius: 8px;
            color: #00ccff;
            font-size: 1em;
            text-shadow: 0 0 5px #00ccff;
            opacity: 0;
            transition: opacity 0.5s ease;
            width: 100%;
            text-align: center;
            max-width: 600px;
        }
        .vote-message.show {
            opacity: 1;
        }
        .review-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            margin: 0;
        }
        .review-form {
            min-width: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: linear-gradient(145deg, #2c2c2a, #3a3a3a);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 204, 255, 0.3), inset 0 0 10px rgba(0, 204, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid rgba(0, 204, 255, 0.4);
        }
        .review-form:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 204, 255, 0.5), inset 0 0 12px rgba(0, 204, 255, 0.2);
        }
        .review-form h3 {
            margin: 0;
            color: #ff3366;
            text-shadow: 0 0 5px #ff3366;
            font-size: 1.4em;
            text-align: center;
        }
        .review-form textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background-color: #3c3c3c;
            color: #fff;
            font-size: 0.9em;
            resize: vertical;
            min-height: 100px;
            transition: background-color 0.3s, box-shadow 0.3s, border-color 0.3s;
            border: 1px solid rgba(0, 204, 255, 0.3);
        }
        .review-form textarea:focus {
            background-color: #4c4c4c;
            box-shadow: 0 0 12px rgba(0, 204, 255, 0.6);
            border-color: #00ccff;
            outline: none;
        }
        .review-form button {
            align-self: center;
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #ff3366, #cc0052);
            color: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
        }
        .review-form button:hover {
            background: linear-gradient(45deg, #cc0052, #ff3366);
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(255, 51, 102, 0.6);
        }
        .reviews {
            min-width: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: linear-gradient(145deg, #222222, #2a2a2a);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid rgba(255, 51, 102, 0.4);
            box-shadow: 0 6px 15px rgba(255, 51, 102, 0.3), inset 0 0 10px rgba(255, 51, 102, 0.1);
        }
        .reviews h3 {
            margin: 0 0 10px;
            color: #ff3366;
            text-shadow: 0 0 5px #ff3366;
            font-size: 1.4em;
            text-align: center;
        }
        .review {
            background: linear-gradient(145deg, #2c2c2a, #333333);
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            border-left: 4px solid #00ccff;
        }
        .review:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 204, 255, 0.3);
        }
        .review.kermi {
            border: 2px solid #ff0000;
            box-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
            animation: kermi-glow 1.5s ease-in-out infinite alternate;
        }
        @keyframes kermi-glow {
            from {
                box-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
            }
            to {
                box-shadow: 0 0 15px #ff0000, 0 0 30px #ff0000;
            }
        }
        .review p {
            margin: 0;
            color: #ddd;
            line-height: 1.6;
            font-size: 0.9em;
        }
        .review .username {
            color: #ddd;
            font-weight: bold;
        }
        .review .username.kermi {
            color: #ff0000;
        }
        .review .delete-button {
            margin-top: 8px;
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            background-color: #ff3366;
            color: #fff;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.3s, transform 0.2s;
        }
        .review .delete-button:hover {
            background-color: #cc0052;
            transform: scale(1.05);
        }
        .review::before {
            content: '★';
            position: absolute;
            top: 12px;
            left: -20px;
            color: #ffd700;
            font-size: 1em;
            text-shadow: 0 0 5px #ffd700;
        }
        .no-reviews {
            color: #ccc;
            text-align: center;
            font-style: italic;
            padding: 15px;
            background: rgba(60, 60, 60, 0.3);
            border-radius: 8px;
        }
        .back-button {
            margin: 20px auto;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background-color: #ff3366;
            color: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            display: block;
            text-align: center;
            text-decoration: none;
        }
        .back-button:hover {
            background-color: #cc0052;
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 51, 102, 0.5);
        }
        #registerModal, #loginModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }
        #registerModal div, #loginModal div {
            background: #2c2c2c;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            width: 100%;
        }
        #registerModal h3, #loginModal h3 {
            color: #ff3366;
            text-shadow: 0 0 5px #ff3366;
        }
        #registerModal input, #loginModal input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background: #3c3c3c;
            color: #fff;
        }
        #registerModal button, #loginModal button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #ff3366;
            color: #fff;
            cursor: pointer;
            margin: 5px;
        }
        #registerModal button:hover, #loginModal button:hover {
            background: #cc0052;
            transform: scale(1.05);
        }
        #registerMessage, #loginMessage {
            color: #00ccff;
            margin-top: 10px;
        }
        @media (max-width: 900px) {
            .movie-card {
                flex-direction: column;
                align-items: center;
            }
            .movie-poster img {
                max-width: 100%;
            }
            .trailer-section iframe {
                height: 300px;
            }
        }
        @media (max-width: 600px) {
            h1 {
                font-size: 2em;
            }
            .star-rating .star {
                font-size: 1.5em;
                width: 20px;
            }
            .average-rating {
                font-size: 1.1em;
            }
            .vote-count {
                font-size: 0.9em;
            }
            .review-form, .reviews {
                padding: 15px;
            }
            .auth-buttons {
                position: static;
                justify-content: center;
                margin-top: 10px;
            }
            .download-button {
                font-size: 1em;
                padding: 10px 20px;
            }
            .review-form h3, .reviews h3 {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>PirateFlix</h1>
        <div class="auth-buttons" id="authButtons"></div>
    </header>
    <div id="registerModal">
        <div>
            <h3>Регистрация</h3>
            <form id="registerForm">
                <input type="text" id="regUsername" placeholder="Имя пользователя">
                <input type="password" id="regPassword" placeholder="Пароль">
                <button type="submit">Зарегистрироваться</button>
                <button type="button" onclick="closeRegisterModal()">Закрыть</button>
            </form>
            <p id="registerMessage"></p>
        </div>
    </div>
    <div id="loginModal">
        <div>
            <h3>Вход</h3>
            <form id="loginForm">
                <input type="text" id="loginUsername" placeholder="Имя пользователя">
                <input type="password" id="loginPassword" placeholder="Пароль">
                <button type="submit">Войти</button>
                <button type="button" onclick="closeLoginModal()">Закрыть</button>
            </form>
            <p id="loginMessage"></p>
        </div>
    </div>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Поиск фильмов...">
        <button onclick="searchMovies()">Найти</button>
    </div>
    <a href="home.html" class="back-button">Назад к фильмам</a>
    <div class="container">
        <div class="movie-card" id="movieCard">
            <div class="movie-poster">
                <img id="moviePoster" src="" alt="Обложка фильма">
            </div>
            <div class="movie-info">
                <h2 id="movieTitle"></h2>
                <p id="movieGenres"></p>
                <p id="movieDirector"></p>
                <p id="movieStudio"></p>
                <p id="moviePremiere"></p>
                <p id="movieDescription"></p>
                <div class="ratings" id="movieRatings"></div>
            </div>
            <div id="videoSection" class="trailer-section">
                <h3>Трейлер фильма</h3>
                <iframe id="movieTrailer" 
                        width="560" 
                        height="315" 
                        src="" 
                        title="YouTube video player" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                        referrerpolicy="strict-origin-when-cross-origin" 
                        allowfullscreen>
                </iframe>
                <a href="file.mp4" download class="download-button">Скачать фильм</a>
                <div class="user-interaction">
                    <div class="rating-section">
                        <div class="star-rating-container">
                            <div class="star-rating" id="starRating">
                                <span class="star" data-value="1">☆</span>
                                <span class="star" data-value="2">☆</span>
                                <span class="star" data-value="3">☆</span>
                                <span class="star" data-value="4">☆</span>
                                <span class="star" data-value="5">☆</span>
                            </div>
                            <div class="rating-info">
                                <span class="average-rating"><span id="avgRating">0</span></span>
                                <span class="vote-count">(<span id="voteCount">0</span> голосов)</span>
                            </div>
                        </div>
                        <div class="vote-message" id="voteMessage"></div>
                    </div>
                    <div class="review-section">
                        <div class="review-form">
                            <h3>Оставить отзыв</h3>
                            <textarea id="reviewText" rows="4" placeholder="Ваш отзыв..."></textarea>
                            <button onclick="submitReview()">Отправить</button>
                        </div>
                        <div class="reviews" id="reviews">
                            <h3>Отзывы</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Простая функция хеширования (небезопасная, для примера)
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString(16);
        }

        // Инициализация базы данных
        function initDatabase() {
            const db = localStorage.getItem('bd.baza');
            if (!db) {
                const initialDb = {
                    users: [],
                    reviews: {},
                    ratings: {}
                };
                localStorage.setItem('bd.baza', JSON.stringify(initialDb));
            }
        }

        const movies = {
            1: {
                title: "Раша Гудбай (2025)",
                poster: "https://s4.vcdn.biz/static/f/9760047691/image.jpg/pt/r375x0x4",
                genres: "Драма, Комедия",
                director: "Алексей Кирющенко",
                studio: "Квартал 95",
                premiere: "27 марта 2025",
                description: "Фильм рассказывает о Рите, жительнице Горловки, которая более 10 лет жила на оккупированной территории, поддерживая оккупантов и работая телеведущей, пропагандирующей ложные идеи об Украине. Из-за наступления Российского добровольческого корпуса она с сыном пытается эвакуироваться в Россию, но оказывается в Ужгороде. Там реальность переворачивает ее мировоззрение. Сможет ли она бросить вызов своим убеждениям?",
                youtubeId: "vF2Sgm3h0qk",
                downloadLink: "https://www.dropbox.com/scl/fi/canuaql4brgzo0h8cdahn/rashagudbai.mp4?rlkey=2fqihz94b2m0lyz1zvit0qvyf&st=uliga0gw&dl=1",
                ratings: [
                    { source: "Kinobaza.com.ua", text: "Пока нет числовых рейтингов. Комментарий: «Гілляка тобі в сраку! Ми подивилися новий кварталівський фільм — і нам відібрало мову»." },
                    { source: "Filmix.my", text: "Спорный отзыв: «Фильм — однобокая провокация одной правды, разжигающая ненависть»." },
                    { source: "Kinofilms.ua", text: "Форумы пока пусты, но пользователи могут начать обсуждение." }
                ]
            },
            2: {
                title: "Снайпер. Белый ворон (2022)",
                poster: "https://upload.wikimedia.org/wikipedia/commons/1/15/WhiteRavenUkr.png",
                genres: "Боевик, Драма, Военный",
                director: "Мариан Бушан",
                studio: "UM Group",
                premiere: "24 мая 2022",
                description: "История украинского снайпера, который после личной трагедии становится добровольцем и вступает в борьбу с врагом. Фильм основан на реальных событиях и рассказывает о мужестве, мести и человеческой стойкости на фоне войны.",
                youtubeId: "VptIeP_TpTU",
                downloadLink: "https://www.dropbox.com/scl/fi/yhqwrv86uzmyqgme2wnah/beliyvoron720.mp4?rlkey=c74jx3yktncvmp0jbl2xby9hh&st=2h10nic6&dl=1",
                ratings: [
                    { source: "Kinowar.com", text: "Оценка 7/10: «Эмоционально сильный фильм, который показывает войну без прикрас»." },
                    { source: "IMDb", text: "Рейтинг 6.4/10: «Сильная актерская игра, но сюжет местами предсказуем»." }
                ]
            },
            5: {
                    title: "Киборги (2017)",
                    poster: "https://upload.wikimedia.org/wikipedia/uk/thumb/8/8f/Kiborhy_%28Ukr_poster_-1%2C_2017%29.jpg/250px-Kiborhy_%28Ukr_poster_-1%2C_2017%29.jpg",
                    genres: "Военный, Драма, Боевик",
                    director: "Ахтем Сеитаблаев",
                    studio: "Ідас Філм",
                    premiere: "7 декабря 2017",
                    description: "Фильм рассказывает о двухнедельном боевом дежурстве украинских военных в Донецком аэропорту в сентябре 2014 года. Группа добровольцев, несмотря на различия в происхождении и возрасте, объединяется для защиты родной земли от агрессора. Лента основана на реальных событиях и подчеркивает героизм защитников, прозванных 'киборгами'.",
                    youtubeId: "Pz6wWUoiiyI",
                    downloadLink: "https://www.dropbox.com/scl/fi/75tsk95mtpl1wawrq49y4/Kiborgi2017720.mp4?rlkey=p9bu8g6m5b787dsehmvk987hx&st=ozhom0xa&dl=1",
                    ratings: [
                        { source: "IMDb", text: "Рейтинг 7.9/10: «Сильная драма о героизме и стойкости украинских военных»." },
                        { source: "Киноафиша", text: "Оценка 8.2/10: «Фильм, который должен посмотреть каждый»." }
                    ]
                },
             4: {
                    title: "Донбасс (2018)",
                    poster: "https://upload.wikimedia.org/wikipedia/ru/thumb/e/ec/%D0%9F%D0%BE%D1%81%D1%82%D0%B5%D1%80_%D1%84%D0%B8%D0%BB%D1%8C%D0%BC%D0%B0_%D0%94%D0%BE%D0%BD%D0%B1%D0%B0%D1%81%D1%81%2C_2018.jpg/640px-%D0%9F%D0%BE%D1%81%D1%82%D0%B5%D1%80_%D1%84%D0%B8%D0%BB%D1%8C%D0%BC%D0%B0_%D0%94%D0%BE%D0%BD%D0%B1%D0%B0%D1%81%D1%81%2C_2018.jpg",
                    genres: "Военная драма",
                    director: "Сергей Лозница",
                    studio: "Arthouse Traffic, Atoms & Void, Graniet Film BV, JBA Productions, Ma.ja.de. Fiction, Ukrainian State Film Agency, Wild at Art",
                    premiere: "9 мая 2018",
                    description: "Фильм 'Донбасс' — это военная драма, состоящая из 13 эпизодов, которые перетекают друг в друга, воссоздавая реальные события на востоке Украины. Основанный на любительских видеороликах с YouTube, снятых обеими сторонами конфликта, фильм показывает абсурд и трагедию войны, размытие границ между правдой и пропагандой, а также жизнь людей в условиях оккупации. Картина подчеркивает антивоенный посыл, не оправдывая насилие ни с одной из сторон.",
                    youtubeId: "mu0g4G3B2jg",
                    downloadLink: "https://mega.nz/file/iQkl1IBS#9ceoOEoY4pOhTMpZUB1PO72DOIa7Dp1LhRsYdZagrT4",
                    ratings: [
                        { source: "IMDb", text: "Рейтинг 6.6/10: «Пронзительный взгляд на абсурд и трагедию войны на востоке Украины»." },
                        { source: "КиноПоиск", text: "Оценка 6.4/10: «Неоднозначная картина, вызывающая споры, но заставляющая задуматься»." }
                    ]
                }

        };

        async function loadMovie() {
            const urlParams = new URLSearchParams(window.location.search);
            let movieId = urlParams.get('id') || '1';
            const movie = movies[movieId];
            if (!movie) {
                document.getElementById('movieCard').innerHTML = '<p>Фильм не найден!</p>';
                return;
            }

            document.getElementById('moviePoster').src = movie.poster;
            document.getElementById('moviePoster').alt = `Обложка ${movie.title}`;
            document.getElementById('movieTitle').textContent = movie.title;
            document.getElementById('movieGenres').innerHTML = `<strong>Жанры:</strong> ${movie.genres}`;
            document.getElementById('movieDirector').innerHTML = `<strong>Режиссер:</strong> ${movie.director}`;
            document.getElementById('movieStudio').innerHTML = `<strong>Студия:</strong> ${movie.studio}`;
            document.getElementById('moviePremiere').innerHTML = `<strong>Премьера:</strong> ${movie.premiere}`;
            document.getElementById('movieDescription').innerHTML = `<strong>Описание:</strong> ${movie.description}`;

            const trailerIframe = document.getElementById('movieTrailer');
            trailerIframe.src = `https://www.youtube.com/embed/${movie.youtubeId}`;
            trailerIframe.title = `Трейлер ${movie.title}`;

            const downloadButton = document.querySelector('.download-button');
            downloadButton.href = movie.downloadLink;

            const ratingsContainer = document.getElementById('movieRatings');
            ratingsContainer.innerHTML = '<h3>Оценки и отзывы:</h3>';
            if (movie.ratings.length) {
                movie.ratings.forEach(rating => {
                    const p = document.createElement('p');
                    p.innerHTML = `<strong>${rating.source}:</strong> ${rating.text}`;
                    ratingsContainer.appendChild(p);
                });
            } else {
                ratingsContainer.innerHTML += '<p>Пока нет отзывов от критиков.</p>';
            }

            updateAverageRating(movieId);
            displayReviews(movieId);
        }

        function searchMovies() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query.includes('раша гудбай') || query.includes('rusha goodbye')) {
                window.location.href = 'site.html?id=1';
            } else if (query.includes('снайпер') || query.includes('белый ворон') || query.includes('sniper')) {
                window.location.href = 'site.html?id=2';
            } else {
                alert('Фильм не найден! Попробуйте "Раша Гудбай" или "Снайпер. Белый ворон"');
            }
        }

        const stars = document.querySelectorAll('.star');
        const voteMessage = document.getElementById('voteMessage');
        let currentUserRating = null;

        function updateAverageRating(movieId) {
            const db = JSON.parse(localStorage.getItem('bd.baza')) || { ratings: {} };
            const ratings = db.ratings[movieId] || [];
            const avgRating = ratings.length ? (ratings.reduce((a, b) => a + b.rating, 0) / ratings.length).toFixed(1) : 0;
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('voteCount').textContent = ratings.length;

            const user = localStorage.getItem('loggedInUser');
            if (user) {
                const userRating = ratings.find(r => r.username === user);
                currentUserRating = userRating ? userRating.rating : null;
            }
            updateStars(currentUserRating || Math.round(avgRating));
        }

        function updateStars(rating) {
            stars.forEach(star => {
                const starValue = parseInt(star.dataset.value);
                if (starValue <= rating) {
                    star.classList.add('filled');
                    star.textContent = '★';
                } else {
                    star.classList.remove('filled');
                    star.textContent = '☆';
                }
            });
        }

        function highlightStars(rating) {
            stars.forEach(star => {
                const starValue = parseInt(star.dataset.value);
                if (starValue <= rating) {
                    star.classList.add('hovered');
                    star.textContent = '★';
                } else {
                    star.classList.remove('hovered');
                    star.textContent = '☆';
                }
            });
        }

        function showVoteMessage(rating) {
            voteMessage.textContent = `Ваша оценка успешно сохранена! Вы поставили ${rating} звезд.`;
            voteMessage.classList.add('show');
            setTimeout(() => {
                voteMessage.classList.remove('show');
            }, 3000);
        }

        stars.forEach(star => {
            star.addEventListener('click', () => {
                const user = localStorage.getItem('loggedInUser');
                if (!user) {
                    alert('Пожалуйста, войдите в систему, чтобы оставить оценку!');
                    return;
                }
                const urlParams = new URLSearchParams(window.location.search);
                let movieId = urlParams.get('id') || '1';
                if (!movieId) return;

                const rating = parseInt(star.dataset.value);
                const db = JSON.parse(localStorage.getItem('bd.baza')) || { ratings: {} };
                if (!db.ratings[movieId]) db.ratings[movieId] = [];
                const existingRating = db.ratings[movieId].find(r => r.username === user);
                if (existingRating) {
                    existingRating.rating = rating;
                } else {
                    db.ratings[movieId].push({ username: user, rating });
                }
                localStorage.setItem('bd.baza', JSON.stringify(db));
                currentUserRating = rating;
                updateStars(rating);
                updateAverageRating(movieId);
                showVoteMessage(rating);
            });

            star.addEventListener('mouseover', () => {
                const rating = parseInt(star.dataset.value);
                highlightStars(rating);
            });

            star.addEventListener('mouseout', () => {
                const urlParams = new URLSearchParams(window.location.search);
                let movieId = urlParams.get('id') || '1';
                const db = JSON.parse(localStorage.getItem('bd.baza')) || { ratings: {} };
                const ratings = db.ratings[movieId] || [];
                const avgRating = ratings.length ? Math.round(ratings.reduce((a, b) => a + b.rating, 0) / ratings.length) : 0;
                updateStars(currentUserRating || avgRating);
            });
        });

        function submitReview() {
            const user = localStorage.getItem('loggedInUser');
            if (!user) {
                alert('Пожалуйста, войдите в систему, чтобы оставить отзыв!');
                return;
            }
            const urlParams = new URLSearchParams(window.location.search);
            let movieId = urlParams.get('id') || '1';
            if (!movieId) return;

            const reviewText = document.getElementById('reviewText').value.trim();
            if (reviewText) {
                const db = JSON.parse(localStorage.getItem('bd.baza')) || { reviews: {} };
                if (!db.reviews[movieId]) db.reviews[movieId] = [];
                db.reviews[movieId].push({ username: user, text: reviewText });
                localStorage.setItem('bd.baza', JSON.stringify(db));
                document.getElementById('reviewText').value = '';
                displayReviews(movieId);
            } else {
                alert('Пожалуйста, напишите отзыв перед отправкой!');
            }
        }

        function deleteReview(movieId, reviewIndex) {
            const user = localStorage.getItem('loggedInUser');
            if (!user) {
                alert('Пожалуйста, войдите в систему, чтобы удалить отзыв!');
                return;
            }

            const db = JSON.parse(localStorage.getItem('bd.baza')) || { reviews: {} };
            const reviews = db.reviews[movieId] || [];
            const review = reviews[reviewIndex];

            if (!review) {
                alert('Отзыв не найден!');
                return;
            }

            if (user === 'Kermi' || review.username === user) {
                reviews.splice(reviewIndex, 1);
                db.reviews[movieId] = reviews;
                localStorage.setItem('bd.baza', JSON.stringify(db));
                displayReviews(movieId);
            } else {
                alert('Вы можете удалять только свои отзывы!');
            }
        }

        function displayReviews(movieId) {
            const db = JSON.parse(localStorage.getItem('bd.baza')) || { reviews: {} };
            const reviews = db.reviews[movieId] || [];
            const reviewsContainer = document.getElementById('reviews');
            const currentUser = localStorage.getItem('loggedInUser');
            reviewsContainer.innerHTML = '<h3>Отзывы</h3>';
            if (reviews.length === 0) {
                const noReviews = document.createElement('p');
                noReviews.className = 'no-reviews';
                noReviews.textContent = 'Пока нет отзывов. Будьте первым!';
                reviewsContainer.appendChild(noReviews);
            } else {
                reviews.forEach((review, index) => {
                    const reviewElement = document.createElement('div');
                    reviewElement.className = 'review';
                    if (review.username === 'Kermi') {
                        reviewElement.className += ' kermi';
                    }
                    const reviewText = document.createElement('p');
                    const usernameSpan = document.createElement('span');
                    usernameSpan.textContent = review.username;
                    usernameSpan.className = 'username';
                    if (review.username === 'Kermi') {
                        usernameSpan.className += ' kermi';
                    }
                    reviewText.appendChild(usernameSpan);
                    reviewText.appendChild(document.createTextNode(`: ${review.text}`));
                    reviewElement.appendChild(reviewText);

                    if (currentUser && (currentUser === review.username || currentUser === 'Kermi')) {
                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'delete-button';
                        deleteButton.textContent = 'Удалить';
                        deleteButton.onclick = () => deleteReview(movieId, index);
                        reviewElement.appendChild(deleteButton);
                    }

                    reviewsContainer.appendChild(reviewElement);
                });
            }
        }

        function showRegisterModal() {
            document.getElementById('registerModal').style.display = 'flex';
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('registerMessage').textContent = '';
            document.getElementById('regUsername').value = '';
            document.getElementById('regPassword').value = '';
        }

        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginMessage').textContent = '';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value.trim();
            
            if (!username || !password) {
                document.getElementById('registerMessage').textContent = 'Заполните все поля!';
                return;
            }

            const db = JSON.parse(localStorage.getItem('bd.baza')) || { users: [] };
            if (db.users.find(user => user.username === username)) {
                document.getElementById('registerMessage').textContent = 'Пользователь уже существует!';
                return;
            }

            db.users.push({ username, password: simpleHash(password) });
            localStorage.setItem('bd.baza', JSON.stringify(db));
            document.getElementById('registerMessage').textContent = 'Регистрация успешна!';
            setTimeout(closeRegisterModal, 1000);
        });

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!username || !password) {
                document.getElementById('loginMessage').textContent = 'Заполните все поля!';
                return;
            }

            const db = JSON.parse(localStorage.getItem('bd.baza')) || { users: [] };
            const user = db.users.find(user => user.username === username && user.password === simpleHash(password));

            if (!user) {
                document.getElementById('loginMessage').textContent = 'Неверное имя пользователя или пароль!';
                return;
            }

            localStorage.setItem('loggedInUser', username);
            updateAuthButtons();
            document.getElementById('loginMessage').textContent = 'Вход успешен!';
            setTimeout(closeLoginModal, 1000);
        });

        function updateAuthButtons() {
            const user = localStorage.getItem('loggedInUser');
            const authButtons = document.getElementById('authButtons');
            if (user) {
                authButtons.innerHTML = `
                    <a href="profile.html" class="username">Привет, ${user}!</a>
                    <button onclick="logout()">Выйти</button>
                `;
            } else {
                authButtons.innerHTML = `
                    <button onclick="showRegisterModal()">Регистрация</button>
                    <button onclick="showLoginModal()">Вход</button>
                `;
            }
        }

        function logout() {
            localStorage.removeItem('loggedInUser');
            updateAuthButtons();
        }

        window.addEventListener('load', () => {
            initDatabase();
            updateAuthButtons();
            loadMovie();
        });
    </script>
</body>
</html>